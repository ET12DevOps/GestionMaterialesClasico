@model IEnumerable<gestionmateriales.Models.OficinaTecnica.Documentos.ItemOrdenTrabajoAplicacion>
@{
    ViewBag.Title = "Selección de Materiales";
}

<div class="container-fluid">
    <h1 class="display-4">Selección de Materiales</h1>
    <div class="row">
        <div class="col-md-6">
            <p>Orden de Trabajo<p>
            <p>Número: <strong>@ViewData["numero"]</strong> - Nombre: <strong>@ViewData["nombre"]</strong></p>
        </div>
        <div class="offset-md-3 col-md-3">
            <a id="btn_generarordentrabajo" class="btn btn-outline-primary btn-block" href="~/ShopCartMaterial/Generar" role="button" data-toggle="tooltip" data-placement="right" title="Genera orden de trabajo de aplicación"> Generar Orden de Trabajo</a>
        </div>
    </div>
    <hr />
    
    <div class="row">
        <table id="tabla_materiales" class="table table-bordered table-striped table-hover">
            <thead>
                <tr>
                    <th>
                        Código
                    </th>
                    <th>
                        Material
                    </th>
                    <th>
                        Stock Actual
                    </th>
                    <th>
                        Cantidad
                    </th>
                    <th>
                        Opciones
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.material.codigo)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.material.nombre)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.material.stockActual)
                        </td>
                        <td>
                            <input id="itemCantidad-@item.material.idMaterial" type="number" min="0" max="@item.material.stockActual" value="@item.cantidad" onclick="updateCant(this)" onkeyup="updateCant(this)" />
                            <script type="text/javascript">
                                        function updateCant(control) {
                                            var appName = location.pathname.split('/')[1];
                                            var baseURL = window.location.protocol + "//" + window.location.host + "/";

                                            if (appName == 'ottest')
                                                baseURL = baseURL + appName + "/";

                                            var str = control.id.split('-');
                                            var strhref = baseURL + "/ShopCartMaterial/AddToCart?idOt=" + @ViewData["idOt"] + "&idMaterial=" + str[1] + "&itemCantidad=" + control.value;
                                            $('#itemLink-' + str[1]).attr("href", strhref);
                                        }
                            </script>
                        </td>
                        <td>
                            @*<div class="btn-group btn-group-sm" role="group" aria-label="Extra-small button group">*@
                            <a title="Agregar" class="btn btn-outline-dark" id="itemLink-@item.material.idMaterial" href="/ShopCartMaterial/AddToCart?idOt=@ViewData["idOt"]&idMaterial=@item.material.idMaterial&itemCantidad=@item.cantidad"><i class="fas fa-plus"></i></a>
                            @*</div>*@
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <script type="text/javascript">
            $('#tabla_materiales').DataTable({
                "language": {
                    "decimal": "",
                    "emptyTable": "No hay información disponible para mostrar",
                    "info": "Mostrando _START_ a _END_ de _TOTAL_ entradas",
                    "infoEmpty": "No hay materiales para mostrar",
                    "infoFiltered": "(filtrados de _MAX_ personas totales)",
                    "infoPostFix": "",
                    "thousands": ",",
                    "lengthMenu": "Ver _MENU_ materiales por página",
                    "loadingRecords": "Cargando...",
                    "processing": "En proceso...",
                    "search": "Buscar",
                    "zeroRecords": "No hay materiales que coincidan con el filtro",
                    "paginate": {
                        "first": "Primera",
                        "last": "Última",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    }
                }
            });
            $('#btn_generarordentrabajo').tooltip();
        </script>
    </div>
</div>